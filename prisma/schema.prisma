generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Difficulty {
  easy
  medium
  hard
}

model User {
  id        String         @id @default(cuid())
  email     String         @unique
  name      String?
  progress  UserProgress[]
  createdAt DateTime       @default(now())
}

model Question {
  id               String         @id @default(cuid())
  question         String
  answers          String // JSON stringified array
  correctIndex     Int
  topic            String
  subtopic         String
  level            Difficulty
  explanation      String
  explanationWrong String // JSON stringified array
  createdAt        DateTime       @default(now())
  progress         UserProgress[]
}

model UserProgress {
  id         String   @id @default(cuid())
  user       User     @relation(fields: [userId], references: [id])
  userId     String
  question   Question @relation(fields: [questionId], references: [id])
  questionId String

  attempts     Int       @default(0) // Wie oft versucht
  wrongAnswers Int       @default(0) // Wie oft falsch
  lastSeen     DateTime? // Wann zuletzt angezeigt
  nextReview   DateTime? // FÃ¼r Spaced Repetition
  nextRound    Int       @default(0) // NEU

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([userId, questionId]) // jeder User kann Frage nur 1x tracken
}
